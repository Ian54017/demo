<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Venue Timetable</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

/* Header Styles */
.header {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    padding: 20px 30px;
    color: white;
}

.main-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.header-left {
    display: flex;
    align-items: center;
    gap: 20px;
}

.header-right {
    display: flex;
    align-items: center;
    gap: 15px;
}

.user-info {
    background: rgba(255, 255, 255, 0.2);
    padding: 10px 15px;
    border-radius: 10px;
    backdrop-filter: blur(10px);
    display: flex;
    flex-direction: column;
    align-items: flex-end;
}

.user-id {
    font-weight: bold;
    font-size: 16px;
}

.current-time {
    font-size: 12px;
    opacity: 0.8;
    margin-top: 5px;
}

/* Collapsible sections */
.collapsible-sections {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.collapsible-section {
    background: rgba(255, 255, 255, 0.15);
    border-radius: 10px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.section-header {
    padding: 10px 15px;
    cursor: pointer;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
}

.section-header:hover {
    background: rgba(255, 255, 255, 0.1);
}

.section-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    background: rgba(255, 255, 255, 0.1);
}

.section-content.expanded {
    max-height: 200px;
    padding: 15px;
}

.chevron {
    transition: transform 0.3s ease;
}

.chevron.expanded {
    transform: rotate(180deg);
}

/* Filter Controls */
.filter-controls {
    display: flex;
    gap: 15px;
    align-items: center;
    flex-wrap: wrap;
}

.filter-controls label {
    font-weight: 600;
}

.filter-controls select,
.filter-controls input {
    padding: 8px 12px;
    border: none;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.9);
    font-size: 14px;
    min-width: 120px;
}

/* Skill Level Controls */
.skill-controls {
    display: flex;
    gap: 20px;
    align-items: center;
    flex-wrap: wrap;
}

.skill-option {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    padding: 8px 12px;
    border: 2px solid transparent;
    border-radius: 8px;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.1);
}

.skill-option:hover {
    background: rgba(255, 255, 255, 0.2);
}

.skill-option input[type="radio"] {
    display: none;
}

.skill-option input[type="radio"]:checked + .skill-circle {
    transform: scale(1.2);
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
}

.skill-option input[type="radio"]:checked ~ .skill-text {
    font-weight: 700;
    color: white;
}

.skill-circle {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 2px solid white;
    transition: all 0.3s ease;
}

.skill-circle.beginner {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
}

.skill-circle.advanced {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
}

.skill-text {
    font-size: 14px;
    font-weight: 600;
    color: white;
    transition: all 0.3s ease;
}

/* Time Management Controls */
.time-controls {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.time-adjust-container {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.time-adjust-btn {
    background: rgba(255, 255, 255, 0.25);
    border: none;
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    font-size: 12px;
    transition: all 0.3s ease;
    min-width: 40px;
}

.time-adjust-btn:hover {
    background: rgba(255, 255, 255, 0.35);
}

.time-adjust-btn.reset {
    background: rgba(255, 193, 7, 0.25);
}

.time-status {
    font-size: 12px;
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: 600;
}

.time-check-active {
    background: rgba(46, 213, 115, 0.3);
}

.time-check-paused {
    background: rgba(255, 107, 107, 0.3);
}

/* Buttons */
.btn {
    background: rgba(255, 255, 255, 0.3);
    border: none;
    color: white;
    padding: 8px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    font-size: 14px;
}

.btn:hover {
    background: rgba(255, 255, 255, 0.4);
    transform: translateY(-2px);
}

.btn.primary {
    background: rgba(255, 255, 255, 0.25);
}

/* QR Code Styles */
.qr-section {
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: center;
}

.qr-code-container {
    background: white;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    max-width: 300px;
}

.qr-code-container img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
}

.qr-instructions {
    font-size: 12px;
    color: rgba(255, 255, 255, 0.8);
    text-align: center;
    margin-top: 8px;
}

/* Main Content */
.main-content {
    padding: 30px;
}

.timetable-container {
    overflow-x: auto;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    background: white;
}

.timetable {
    width: 100%;
    border-collapse: collapse;
    background: white;
    min-width: 800px;
}

.timetable th {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 8px 4px;
    text-align: center;
    font-weight: 600;
    position: sticky;
    top: 0;
    z-index: 10;
    font-size: 12px;
    min-width: 50px;
}

.timetable th:first-child {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    position: sticky;
    left: 0;
    z-index: 11;
    min-width: 120px;
    padding: 8px 15px;
}

.timetable td:first-child {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
    font-weight: 600;
    text-align: center;
    position: sticky;
    left: 0;
    z-index: 9;
    padding: 8px 15px;
    font-size: 14px;
}

.timetable td {
    border: 1px solid #e0e0e0;
    padding: 0;
    text-align: center;
    position: relative;
    width: 50px;
    height: 50px;
    vertical-align: middle;
}

/* Cell Content Styles - Collapsed State */
.cell-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    width: 100%;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    padding: 2px;
}

.cell-content:hover:not(.venue-closed):not(.time-frozen) {
    background: rgba(79, 172, 254, 0.1);
}

/* Collapsed state styles */
.cell-content.collapsed {
    gap: 1px;
}

.cell-content.collapsed .capacity-info {
    font-size: 8px;
    color: #666;
    line-height: 1;
}

.cell-content.collapsed .user-dots-container {
    display: flex;
    justify-content: center;
    align-items: center;
    flex: 1;
    width: 100%;
}

.user-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    margin: 1px;
    border: 1px solid white;
    transition: all 0.3s ease;
}

.user-dot.beginner {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
}

.user-dot.advanced {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
}

.user-dot.current-user {
    border: 1px solid #FFC107;
    animation: pulse-dot 2s infinite;
}

@keyframes pulse-dot {
    0% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
    70% { box-shadow: 0 0 0 3px rgba(255, 193, 7, 0); }
    100% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
}

.user-count-overflow {
    font-size: 7px;
    color: #666;
    font-weight: bold;
    margin-left: 2px;
}

/* Expanded state styles */
.cell-content.expanded {
    position: absolute;
    z-index: 100;
    background: white;
    border: 3px solid #4facfe;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    width: 200px;
    height: 150px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 10px;
    gap: 8px;
}

.cell-content.expanded .capacity-info {
    font-size: 14px;
    color: #666;
    order: 1;
}

.cell-content.expanded .initials-container {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 60px;
    width: 100%;
    order: 2;
    flex: 1;
}

.cell-content.expanded .user-initial-circle {
    position: absolute;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: bold;
    border: 2px solid white;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 15;
}

.cell-content.expanded .user-initial-circle:hover {
    transform: scale(1.2) !important;
    z-index: 25;
}

.cell-content.expanded .user-initial-circle.beginner {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
}

.cell-content.expanded .user-initial-circle.advanced {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
}

.cell-content.expanded .user-initial-circle.current-user {
    border: 3px solid #FFC107;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15), 0 0 0 0 rgba(255, 193, 7, 0.7); }
    70% { box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15), 0 0 0 8px rgba(255, 193, 7, 0); }
    100% { box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15), 0 0 0 0 rgba(255, 193, 7, 0); }
}

.cell-content.expanded .participants {
    font-size: 12px;
    color: #888;
    order: 3;
}

.cell-content.expanded .cancel-btn {
    background: #ff4757;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    order: 4;
}

.cell-content.expanded .cancel-btn:hover {
    background: #ff3742;
}

/* Cell States */
.booked-cell {
    background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    border: 2px solid #4facfe;
}

.user-booked-cell {
    background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
    border: 2px solid #ff6b6b;
}

.full-cell {
    background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
    cursor: not-allowed;
}

.venue-closed {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%) !important;
    color: white !important;
    cursor: not-allowed;
}

.time-frozen {
    opacity: 0.5;
    background: linear-gradient(135deg, #e0e0e0 0%, #bdbdbd 100%) !important;
    cursor: not-allowed !important;
}

.time-passed {
    background: linear-gradient(135deg, #e0e0e0 0%, #bdbdbd 100%) !important;
    color: #757575 !important;
}

.closed-text {
    font-weight: 700;
    font-size: 8px;
    text-align: center;
    padding: 2px;
}

.past-indicator {
    position: absolute;
    top: 2px;
    left: 2px;
    background: #757575;
    color: white;
    padding: 1px 3px;
    border-radius: 2px;
    font-size: 6px;
    font-weight: bold;
    z-index: 20;
}

/* Legend */
.legend {
    display: flex;
    justify-content: flex-end;
    gap: 20px;
    margin-top: 20px;
    flex-wrap: wrap;
    align-items: center;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
}

.legend-color {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    border: 1px solid #ddd;
}

/* Login Form */
.login-form {
    background: rgba(255, 255, 255, 0.9);
    padding: 40px;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    max-width: 400px;
    margin: 50px auto;
    text-align: center;
}

.login-form h2 {
    color: #333;
    margin-bottom: 30px;
    font-size: 28px;
}

.login-form input {
    width: 100%;
    padding: 15px;
    margin-bottom: 20px;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 16px;
    transition: all 0.3s ease;
}

.login-form input:focus {
    outline: none;
    border-color: #4facfe;
    box-shadow: 0 0 10px rgba(79, 172, 254, 0.3);
}

.login-btn {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.login-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
}

.admin-checkbox {
    margin: 20px 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.admin-checkbox label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-size: 14px;
    color: #333;
    gap: 10px;
}

.admin-checkbox input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: #4facfe;
}

/* Admin Styles */
.admin-content {
    padding: 30px;
    display: grid;
    gap: 30px;
}

.admin-tabs {
    display: flex;
    gap: 5px;
    margin-bottom: 30px;
    border-bottom: 2px solid #e0e0e0;
}

.admin-tab {
    background: transparent;
    border: none;
    padding: 12px 20px;
    cursor: pointer;
    font-weight: 600;
    color: #666;
    border-bottom: 3px solid transparent;
    transition: all 0.3s ease;
}

.admin-tab:hover {
    color: #4facfe;
    background: rgba(79, 172, 254, 0.1);
}

.admin-tab.active {
    color: #4facfe;
    border-bottom-color: #4facfe;
}

.admin-tab-content {
    display: none;
}

.admin-tab-content.active {
    display: block;
}

.admin-booking-layout {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 30px;
    height: 80vh;
}

.admin-sidebar {
    display: flex;
    flex-direction: column;
    gap: 20px;
    overflow-y: auto;
}

.admin-main-grid {
    display: flex;
    flex-direction: column;
    gap: 20px;
    overflow: hidden;
}

.admin-grid-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.admin-grid-header h3 {
    margin: 0;
    color: #333;
}

.grid-controls {
    display: flex;
    gap: 15px;
    align-items: center;
    flex-wrap: wrap;
}

.grid-controls label {
    font-weight: 600;
    color: #333;
}

.grid-controls select {
    padding: 8px 12px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    min-width: 120px;
}

.admin-timetable-container {
    overflow: auto;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    background: white;
    flex: 1;
}

.date-controls {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.date-controls input[type="date"] {
    padding: 10px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
}

.quick-actions {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.bulk-select {
    padding: 8px 12px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    width: 100%;
}

.btn.danger {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
    color: white;
}

.btn.danger:hover {
    background: linear-gradient(135deg, #ff5252 0%, #e53935 100%);
}

.admin-legend {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.admin-section {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.admin-section h3 {
    color: #333;
    margin: 0 0 15px 0;
    font-size: 18px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.venue-management {
    display: grid;
    gap: 20px;
}

.venue-list {
    display: grid;
    gap: 15px;
}

.venue-item {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 20px;
    border-left: 5px solid #4facfe;
    display: grid;
    grid-template-columns: 1fr auto auto;
    gap: 15px;
    align-items: center;
}

.venue-info h4 {
    margin: 0 0 5px 0;
    color: #333;
}

.venue-info p {
    margin: 0;
    color: #666;
    font-size: 14px;
}

.venue-actions {
    display: flex;
    gap: 10px;
}

.venue-actions button {
    padding: 6px 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.edit-btn {
    background: #4facfe;
    color: white;
}

.delete-btn {
    background: #ff6b6b;
    color: white;
}

.add-venue {
    background: #28a745;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.add-venue:hover {
    transform: translateY(-2px);
}

/* Admin-specific cell states */
.admin-blocked-cell {
    background: linear-gradient(135deg, #ffa502 0%, #ff6348 100%) !important;
    color: white !important;
    cursor: pointer;
}

.admin-blocked-text {
    font-weight: 700;
    font-size: 8px;
    text-align: center;
    padding: 2px;
    color: white;
}

.admin-cell-content {
    position: relative;
}

.admin-cell-content .admin-actions {
    display: none;
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    border: 2px solid #4facfe;
    border-radius: 8px;
    padding: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    z-index: 200;
    min-width: 120px;
}

.admin-cell-content.expanded .admin-actions {
    display: block;
}

.admin-action-btn {
    display: block;
    width: 100%;
    margin: 2px 0;
    padding: 6px 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 11px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.admin-action-btn.block {
    background: #ffa502;
    color: white;
}

.admin-action-btn.unblock {
    background: #28a745;
    color: white;
}

.admin-action-btn.clear {
    background: #ff6b6b;
    color: white;
}

.admin-action-btn:hover {
    transform: scale(1.05);
}

/* Modal Styles */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    z-index: 1000;
    backdrop-filter: blur(5px);
}

.modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    width: 90%;
    max-width: 500px;
    max-height: 80vh;
    overflow: hidden;
    z-index: 1001;
}

.modal-header {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
    padding: 20px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    margin: 0;
    font-size: 20px;
}

.close-btn {
    background: rgba(255, 255, 255, 0.3);
    border: none;
    color: white;
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
}

.modal-content {
    padding: 30px;
    max-height: 60vh;
    overflow-y: auto;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: #333;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 10px 15px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.3s ease;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #4facfe;
    box-shadow: 0 0 10px rgba(79, 172, 254, 0.2);
}

.time-slots-editor {
    display: grid;
    gap: 10px;
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 15px;
}

.time-slot-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px;
    background: #f8f9fa;
    border-radius: 6px;
}

.time-slot-item input {
    flex: 1;
    padding: 5px 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.remove-time-btn {
    background: #ff6b6b;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
}

.add-time-btn {
    background: #28a745;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    margin-top: 10px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .header {
        padding: 15px 20px;
    }

    .main-header {
        flex-direction: column;
        gap: 15px;
    }

    .header-left,
    .header-right {
        width: 100%;
        justify-content: center;
    }

    .collapsible-sections {
        width: 100%;
        justify-content: center;
    }

    .collapsible-section {
        width: 100%;
    }

    .filter-controls,
    .skill-controls {
        justify-content: center;
    }

    .time-adjust-container {
        justify-content: center;
    }

    .main-content {
        padding: 20px;
    }

    .legend {
        justify-content: center;
        gap: 15px;
    }

    .venue-item {
        grid-template-columns: 1fr;
        text-align: center;
    }

    .venue-actions {
        justify-content: center;
    }

    .modal {
        width: 95%;
        margin: 20px;
    }

    .modal-content {
        padding: 20px;
    }

    .timetable td {
        height: 45px;
        width: 45px;
    }

    .admin-content {
        padding: 20px;
        gap: 20px;
    }
    
    .admin-section {
        padding: 20px;
    }

    .cell-content.expanded {
        width: 180px;
        height: 130px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Form -->
        <div id="loginForm" class="login-form">
            <h2>Welcome to Venue Booking</h2>
            <input type="text" id="userIdInput" placeholder="Enter your User ID" maxlength="20">
            
            <div class="admin-checkbox">
                <label for="adminCheck">
                    <input type="checkbox" id="adminCheck">
                    <span class="checkmark">Administrator Login</span>
                </label>
            </div>
            
            <button class="login-btn" onclick="login()">Login</button>
        </div>

        <!-- User App -->
        <div id="mainApp" style="display: none;">
            <div class="header">
                <div class="main-header">
                    <div class="header-left">
                        <h2>üìã Venue Booking System</h2>
                    </div>
                    <div class="header-right">
                        <div class="user-info">
                            <div class="user-id" id="userDisplay"></div>
                            <div class="current-time" id="currentTime"></div>
                        </div>
                        <button class="btn primary" onclick="toggleMessageBoard()">üì¢ Messages</button>
                        <button class="btn" onclick="logout()">Logout</button>
                    </div>
                </div>

                <!-- Collapsible Sections -->
                <div class="collapsible-sections">
                    <!-- Filter Section -->
                    <div class="collapsible-section">
                        <div class="section-header" onclick="toggleSection('filters')">
                            üîç Filters
                            <span class="chevron" id="filters-chevron">‚ñº</span>
                        </div>
                        <div class="section-content" id="filters-content">
                            <div class="filter-controls">
                                <label for="venueFilter">Field:</label>
                                <select id="venueFilter" onchange="filterTable()">
                                    <option value="">All Fields</option>
                                </select>
                                
                                <label for="timeFilter">Time:</label>
                                <select id="timeFilter" onchange="filterTable()">
                                    <option value="">All Times</option>
                                </select>

                                <button class="btn" onclick="filterUpcoming()">Filter Available</button>
                            </div>
                        </div>
                    </div>

                    <!-- Skill Level Section -->
                    <div class="collapsible-section">
                        <div class="section-header" onclick="toggleSection('skill')">
                            üéØ Skill Level
                            <span class="chevron" id="skill-chevron">‚ñº</span>
                        </div>
                        <div class="section-content" id="skill-content">
                            <div class="skill-controls">
                                <label class="skill-option">
                                    <input type="radio" name="skillLevel" value="beginner" checked onchange="changeSkillLevel()">
                                    <span class="skill-circle beginner"></span>
                                    <span class="skill-text">Beginner</span>
                                </label>
                                <label class="skill-option">
                                    <input type="radio" name="skillLevel" value="advanced" onchange="changeSkillLevel()">
                                    <span class="skill-circle advanced"></span>
                                    <span class="skill-text">Advanced</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Time Management Section -->
                    <div class="collapsible-section">
                        <div class="section-header" onclick="toggleSection('time')">
                            ‚è∞ Time Controls
                            <span class="chevron" id="time-chevron">‚ñº</span>
                        </div>
                        <div class="section-content" id="time-content">
                            <div class="time-controls">
                                <div class="time-adjust-container">
                                    <span style="font-size: 12px; font-weight: 600;">Test Time:</span>
                                    <button class="time-adjust-btn" onclick="adjustTimeOffset(-60)">-1h</button>
                                    <button class="time-adjust-btn" onclick="adjustTimeOffset(-10)">-10m</button>
                                    <button class="time-adjust-btn reset" onclick="resetTimeOffset()">Reset</button>
                                    <button class="time-adjust-btn" onclick="adjustTimeOffset(10)">+10m</button>
                                    <button class="time-adjust-btn" onclick="adjustTimeOffset(60)">+1h</button>
                                </div>
                                <button class="btn" id="toggleTimeBtn" onclick="toggleTimeManagement()">‚è∏Ô∏è Pause Time Check</button>
                                <div class="time-status" id="timeStatus">Time check active</div>
                            </div>
                        </div>
                    </div>

                    <!-- QR Code Section -->
                    <div class="collapsible-section">
                        <div class="section-header" onclick="toggleSection('qr')">
                            üì± Registration QR
                            <span class="chevron" id="qr-chevron">‚ñº</span>
                        </div>
                        <div class="section-content" id="qr-content">
                            <div class="qr-section">
                                <button class="btn" onclick="generateQRCode()">Generate QR Code</button>
                                <div class="qr-code-container" id="qrContainer" style="display: none;">
                                    <img id="qrCodeImage" src="" alt="Registration QR Code">
                                    <div class="qr-instructions">
                                        Scan this QR code to access the registration form for new members.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="timetable-container">
                    <table class="timetable" id="timetable">
                        <thead id="tableHeader"></thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);"></div>
                        <span>Available</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);"></div>
                        <span>Booked by Others</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);"></div>
                        <span>Your Booking</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);"></div>
                        <span>Fully Booked</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);"></div>
                        <span>Venue Closed</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #e0e0e0 0%, #bdbdbd 100%);"></div>
                        <span>Time Passed</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color skill-circle beginner" style="width: 20px; height: 20px; border-radius: 50%;"></div>
                        <span>Beginner Player</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color skill-circle advanced" style="width: 20px; height: 20px; border-radius: 50%;"></div>
                        <span>Advanced Player</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Administrator App -->
        <div id="adminApp" style="display: none;">
            <div class="header">
                <div class="main-header">
                    <div class="header-left">
                        <h2>üîß Administrator Panel</h2>
                    </div>
                    <div class="header-right">
                        <div class="user-info">
                            <div class="user-id" id="adminUserDisplay">Administrator</div>
                            <div class="current-time" id="adminCurrentTime"></div>
                        </div>
                        <button class="btn" onclick="logout()">Logout</button>
                    </div>
                </div>
            </div>

            <div class="admin-content">
                <!-- Admin Tabs -->
                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="switchAdminTab('booking')">üìÖ Booking Management</button>
                    <button class="admin-tab" onclick="switchAdminTab('venue')">üèüÔ∏è Venue Settings</button>
                    <button class="admin-tab" onclick="switchAdminTab('message')">üì¢ Messages</button>
                    <button class="admin-tab" onclick="switchAdminTab('users')">üë• Users</button>
                </div>

                <!-- Booking Management Tab -->
                <div id="adminBookingTab" class="admin-tab-content active">
                    <div class="admin-booking-layout">
                        <!-- Sidebar with Quick Actions -->
                        <div class="admin-sidebar">
                            <div class="admin-section">
                                <h3>üìÖ Date Selection</h3>
                                <div class="date-controls">
                                    <input type="date" id="adminDatePicker" onchange="changeAdminDate()">
                                    <button class="btn" onclick="setAdminDateToday()">Today</button>
                                </div>
                            </div>

                            <div class="admin-section">
                                <h3>‚ö° Quick Actions</h3>
                                <div class="quick-actions">
                                    <select id="bulkActionVenue" class="bulk-select">
                                        <option value="">Select Venue...</option>
                                    </select>
                                    <button class="btn danger" onclick="blockAllVenueSlots()">üö´ Block All Slots</button>
                                    <button class="btn danger" onclick="clearAllVenueBookings()">üóëÔ∏è Clear All Bookings</button>
                                    
                                    <hr style="margin: 15px 0; border: 1px solid #e0e0e0;">
                                    
                                    <select id="bulkActionTime" class="bulk-select">
                                        <option value="">Select Time...</option>
                                    </select>
                                    <button class="btn danger" onclick="blockAllTimeSlots()">üö´ Block Time Across All Venues</button>
                                    <button class="btn danger" onclick="clearAllTimeBookings()">üóëÔ∏è Clear Time Across All Venues</button>
                                </div>
                            </div>

                            <div class="admin-section">
                                <h3>‚ÑπÔ∏è Legend</h3>
                                <div class="admin-legend">
                                    <div class="legend-item">
                                        <div class="legend-color" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);"></div>
                                        <span>Available</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);"></div>
                                        <span>User Bookings</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color" style="background: linear-gradient(135deg, #ffa502 0%, #ff6348 100%);"></div>
                                        <span>Admin Blocked</span>
                                    </div>
                                    <div class="legend-item">
                                        <div class="legend-color" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);"></div>
                                        <span>Venue Closed</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Main Booking Grid -->
                        <div class="admin-main-grid">
                            <div class="admin-grid-header">
                                <h3 id="adminDateTitle">Booking Management - Today</h3>
                                <div class="grid-controls">
                                    <label for="adminVenueFilter">Filter Venue:</label>
                                    <select id="adminVenueFilter" onchange="generateAdminTable()">
                                        <option value="">All Venues</option>
                                    </select>
                                    <label for="adminTimeFilter">Filter Time:</label>
                                    <select id="adminTimeFilter" onchange="generateAdminTable()">
                                        <option value="">All Times</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="admin-timetable-container">
                                <table class="timetable" id="adminTimetable">
                                    <thead id="adminTableHeader"></thead>
                                    <tbody id="adminTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Venue Settings Tab -->
                <div id="adminVenueTab" class="admin-tab-content">
                    <div class="admin-section">
                        <h3>üèüÔ∏è Venue Management</h3>
                        <p style="color: #666; margin-bottom: 20px;">Manage venues, time slots, and availability</p>
                        
                        <button class="add-venue" onclick="showAddVenueModal()">‚ûï Add New Venue</button>
                        
                        <div class="venue-management">
                            <div class="venue-list" id="venueList">
                                <!-- Venue items will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Message Management Tab -->
                <div id="adminMessageTab" class="admin-tab-content">
                    <div class="admin-section">
                        <h3>üì¢ Message Board Management</h3>
                        <p style="color: #666; margin-bottom: 20px;">Manage messages displayed to users</p>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <button class="btn primary" onclick="showAdminMessageBoard()">Manage Messages</button>
                            <button class="btn" onclick="addNewMessage()">Add New Message</button>
                        </div>
                    </div>
                </div>

                <!-- User Management Tab -->
                <div id="adminUserTab" class="admin-tab-content">
                    <div class="admin-section">
                        <h3>üë• User Membership Management</h3>
                        <p style="color: #666; margin-bottom: 20px;">Manage user memberships and expiry dates</p>
                        <button class="btn" onclick="addNewUser()">Add New User</button>
                        <div id="userMembershipContainer" style="margin-top: 20px;">
                            <!-- User membership items will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Message Board Modal -->
    <div id="messageBoardOverlay" class="modal-overlay" onclick="closeMessageBoard()">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>üì¢ Message Board</h3>
                <button class="close-btn" onclick="closeMessageBoard()">‚úï</button>
            </div>
            <div class="modal-content" id="messageBoardContent"></div>
        </div>
    </div>

    <!-- Admin Message Board Modal -->
    <div id="adminMessageBoardOverlay" class="modal-overlay" onclick="closeAdminMessageBoard()">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>üì¢ Manage Messages</h3>
                <button class="close-btn" onclick="closeAdminMessageBoard()">‚úï</button>
            </div>
            <div class="modal-content" id="adminMessageBoardContent"></div>
        </div>
    </div>

    <!-- Add/Edit Venue Modal -->
    <div id="venueModal" class="modal-overlay" onclick="closeVenueModal()">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="venueModalTitle">Add New Venue</h3>
                <button class="close-btn" onclick="closeVenueModal()">‚úï</button>
            </div>
            <div class="modal-content">
                <form id="venueForm">
                    <div class="form-group">
                        <label for="venueName">Venue Name:</label>
                        <input type="text" id="venueName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="venueCapacity">Capacity:</label>
                        <input type="number" id="venueCapacity" min="1" max="10" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="venueStatus">Status:</label>
                        <select id="venueStatus">
                            <option value="open">Open</option>
                            <option value="closed">Closed</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Time Slots:</label>
                        <div class="time-slots-editor" id="timeSlotsEditor">
                            <!-- Time slots will be loaded here -->
                        </div>
                        <button type="button" class="add-time-btn" onclick="addTimeSlot()">‚ûï Add Time Slot</button>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button type="submit" class="btn primary" style="flex: 1;">Save Venue</button>
                        <button type="button" class="btn" onclick="closeVenueModal()" style="flex: 1;">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
// Data structure
let venues = ['Field 1', 'Field 2', 'Field 3', 'Field 4', 'Field 5', 'Field 6', 'Field 7', 'Field 8', 'Field 9'];
let timeSlots = ['19:00', '19:20', '19:40', '20:00', '20:20', '20:40', '21:00', '21:20', '21:40', '22:00', '22:20', '22:40', '23:00'];

// Venue capacities
let venueCapacities = {
    'Field 1': 4, 'Field 2': 4, 'Field 3': 4, 'Field 4': 4, 'Field 5': 4, 
    'Field 6': 4, 'Field 7': 2, 'Field 8': 2, 'Field 9': 2
};

// Venue status
let venueStatus = {
    'Field 1': { open: true, closedDates: [] }, 'Field 2': { open: true, closedDates: [] },
    'Field 3': { open: true, closedDates: [] }, 'Field 4': { open: true, closedDates: [] },
    'Field 5': { open: true, closedDates: [] }, 'Field 6': { open: true, closedDates: [] },
    'Field 7': { open: true, closedDates: [] }, 'Field 8': { open: true, closedDates: [] },
    'Field 9': { open: true, closedDates: [] }
};

// User membership data
let userMembership = {
    'Official Member A': { type: 'official', expiry: new Date(2025, 11, 31) },
    'Temporary Member A': { type: 'temporary', expiry: new Date() }
};

// Booking data
let bookingData = {};
let currentUser = '';
let currentUserSkillLevel = 'beginner';
let userBooking = null;
let isAdmin = false;
let userSkillLevels = {};
let expandedCell = null;

// Message board data
let messages = [
    { id: 1, author: 'System Admin', text: 'Welcome to the new system!!', 
      date: new Date().toLocaleDateString(), timestamp: new Date() }
];

// Time management variables
let timeCheckInterval = null;
let isTimeManagementActive = true;
let timeOffset = 0;

// UI Functions
function toggleSection(sectionId) {
    const content = document.getElementById(`${sectionId}-content`);
    const chevron = document.getElementById(`${sectionId}-chevron`);
    const isExpanded = content.classList.contains('expanded');
    
    if (isExpanded) {
        content.classList.remove('expanded');
        chevron.classList.remove('expanded');
    } else {
        content.classList.add('expanded');
        chevron.classList.add('expanded');
    }
}

function changeSkillLevel() {
    const skillLevel = document.querySelector('input[name="skillLevel"]:checked').value;
    currentUserSkillLevel = skillLevel;
    userSkillLevels[currentUser] = skillLevel;
    updateUserDisplay();
    generateTable();
}

function updateUserDisplay() {
    const skillText = currentUserSkillLevel === 'beginner' ? 'Beginner' : 'Advanced';
    const skillColor = currentUserSkillLevel === 'beginner' ? 'üü¢' : 'üî¥';
    document.getElementById('userDisplay').textContent = `User: ${currentUser} ${skillColor} ${skillText}`;
}

// Time Management Functions
function parseTimeToMinutes(timeStr) {
    const [hours, minutes] = timeStr.split(':').map(Number);
    return hours * 60 + minutes;
}

function getCurrentTimeInMinutes() {
    const now = new Date();
    now.setMinutes(now.getMinutes() + timeOffset);
    return now.getHours() * 60 + now.getMinutes();
}

function getAdjustedTime() {
    const now = new Date();
    now.setMinutes(now.getMinutes() + timeOffset);
    return now;
}

function adjustTimeOffset(minutes) {
    timeOffset += minutes;
    manageCellStatesByTime();
    updateTimeDisplay();
    showNotification(`Time adjusted by ${minutes} minutes`);
}

function resetTimeOffset() {
    timeOffset = 0;
    manageCellStatesByTime();
    updateTimeDisplay();
    showNotification('Time reset to actual system time');
}

function toggleTimeManagement() {
    isTimeManagementActive = !isTimeManagementActive;
    const toggleBtn = document.getElementById('toggleTimeBtn');
    const timeStatus = document.getElementById('timeStatus');
    
    if (isTimeManagementActive) {
        toggleBtn.textContent = '‚è∏Ô∏è Pause Time Check';
        timeStatus.textContent = 'Time check active';
        timeStatus.className = 'time-status time-check-active';
        manageCellStatesByTime();
    } else {
        toggleBtn.textContent = '‚ñ∂Ô∏è Resume Time Check';
        timeStatus.textContent = 'Time check paused';
        timeStatus.className = 'time-status time-check-paused';
        clearTimeFreeze();
    }
}

function manageCellStatesByTime() {
    if (!isTimeManagementActive) return;
    
    const tableHeader = document.getElementById('tableHeader');
    const tableBody = document.getElementById('tableBody');
    if (!tableHeader || !tableBody) return;
    
    const currentMinutes = getCurrentTimeInMinutes();
    const headerCells = tableHeader.getElementsByTagName('th');
    
    // Update time header styling
    for (let i = 1; i < headerCells.length; i++) {
        const timeSlot = headerCells[i].textContent.trim();
        const slotMinutes = parseTimeToMinutes(timeSlot);
        const isPassed = currentMinutes >= slotMinutes;
        
        if (isPassed) {
            headerCells[i].classList.add('time-passed');
        } else {
            headerCells[i].classList.remove('time-passed');
        }
    }
    
    // Update cell content
    const rows = tableBody.getElementsByTagName('tr');
    for (let row of rows) {
        for (let i = 1; i < row.cells.length; i++) {
            const cell = row.cells[i];
            const cellContent = cell.querySelector('.cell-content');
            const timeSlot = headerCells[i].textContent.trim();
            const slotMinutes = parseTimeToMinutes(timeSlot);
            const isPassed = currentMinutes >= slotMinutes;
            
            if (cellContent) {
                if (isPassed) {
                    freezeCell(cellContent);
                } else {
                    unfreezeCell(cellContent);
                }
            }
        }
    }
}

function freezeCell(cellContent) {
    cellContent.classList.add('time-frozen');
    cellContent.onclick = null;
    
    const cancelBtn = cellContent.querySelector('.cancel-btn');
    if (cancelBtn) {
        cancelBtn.disabled = true;
    }
    
    if (!cellContent.querySelector('.past-indicator')) {
        const pastIndicator = document.createElement('div');
        pastIndicator.className = 'past-indicator';
        pastIndicator.textContent = 'PAST';
        cellContent.appendChild(pastIndicator);
    }
}

function unfreezeCell(cellContent) {
    cellContent.classList.remove('time-frozen');
    
    const cancelBtn = cellContent.querySelector('.cancel-btn');
    if (cancelBtn) {
        cancelBtn.disabled = false;
    }
    
    const pastIndicator = cellContent.querySelector('.past-indicator');
    if (pastIndicator) {
        pastIndicator.remove();
    }
}

function clearTimeFreeze() {
    const frozenCells = document.querySelectorAll('.time-frozen');
    frozenCells.forEach(cell => unfreezeCell(cell));
}

function updateTimeDisplay() {
    const adjustedTime = getAdjustedTime();
    const timeStr = adjustedTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    
    if (timeOffset !== 0) {
        const sign = timeOffset > 0 ? '+' : '';
        const offsetDisplay = `Testing Time: ${timeStr} (${sign}${timeOffset} min)`;
        document.getElementById('timeStatus').textContent = offsetDisplay;
    }
}

// Cell Expansion Functions
function expandCell(cellElement, venue, time) {
    if (expandedCell && expandedCell !== cellElement) {
        collapseCell(expandedCell);
    }
    
    expandedCell = cellElement;
    cellElement.classList.add('expanded');
    cellElement.classList.remove('collapsed');
    
    // Rebuild content for expanded view
    const capacity = venueCapacities[venue];
    const booked = bookingData[venue][time].length;
    const bookedUsers = bookingData[venue][time];
    const isUserBooked = userBooking && userBooking.venue === venue && userBooking.time === time;
    const isFull = booked >= capacity;
    
    cellElement.innerHTML = '';
    
    // Capacity info
    const capacityInfo = document.createElement('div');
    capacityInfo.className = 'capacity-info';
    capacityInfo.textContent = `${booked}/${capacity}`;
    cellElement.appendChild(capacityInfo);
    
    // User initials display for expanded view
    if (booked > 0) {
        const initialsContainer = document.createElement('div');
        initialsContainer.className = 'initials-container';
        
        bookedUsers.forEach((user, index) => {
            const initialsCircle = document.createElement('div');
            initialsCircle.className = 'user-initial-circle';
            
            const userSkillLevel = userSkillLevels[user] || 'beginner';
            initialsCircle.classList.add(userSkillLevel);
            
            if (user === currentUser) {
                initialsCircle.classList.add('current-user');
            }
            
            initialsCircle.textContent = getUserInitials(user);
            initialsCircle.title = `${user} (${userSkillLevel === 'beginner' ? 'Beginner' : 'Advanced'})`;
            
            const angle = (index * 360) / Math.max(capacity, booked);
            const radius = 20;
            const x = Math.cos((angle * Math.PI) / 180) * radius;
            const y = Math.sin((angle * Math.PI) / 180) * radius;
            
            initialsCircle.style.transform = `translate(${x}px, ${y}px)`;
            initialsContainer.appendChild(initialsCircle);
        });
        
        cellElement.appendChild(initialsContainer);
    }
    
    // Participants info
    if (booked > 0) {
        const participants = document.createElement('div');
        participants.className = 'participants';
        participants.textContent = `${booked} participant${booked > 1 ? 's' : ''}`;
        cellElement.appendChild(participants);
    }
    
    // Action buttons container
    const buttonsContainer = document.createElement('div');
    buttonsContainer.style.cssText = 'display: flex; gap: 8px; justify-content: center; order: 4;';
    
    // Cancel button for user's booking (if user has booked this slot)
    if (isUserBooked) {
        const cancelBtn = document.createElement('button');
        cancelBtn.className = 'cancel-btn';
        cancelBtn.textContent = 'Cancel';
        cancelBtn.onclick = (e) => {
            e.stopPropagation();
            cancelBooking();
        };
        buttonsContainer.appendChild(cancelBtn);
    }
    
    // Book button (if not full and user hasn't booked this slot)
    if (!isFull && !isUserBooked) {
        const bookBtn = document.createElement('button');
        bookBtn.className = 'book-btn';
        bookBtn.textContent = 'Book';
        bookBtn.style.cssText = `
            background: #28a745; color: white; border: none; padding: 6px 12px;
            border-radius: 6px; font-size: 12px; cursor: pointer; transition: all 0.3s ease;
        `;
        bookBtn.onmouseover = () => bookBtn.style.background = '#218838';
        bookBtn.onmouseout = () => bookBtn.style.background = '#28a745';
        bookBtn.onclick = (e) => {
            e.stopPropagation();
            bookSlot(venue, time);
        };
        buttonsContainer.appendChild(bookBtn);
    }
    
    // Add buttons container if it has any buttons
    if (buttonsContainer.children.length > 0) {
        cellElement.appendChild(buttonsContainer);
    }
    
    // Stop propagation to prevent immediate collapse
    cellElement.onclick = (e) => e.stopPropagation();
}

function collapseCell(cellElement) {
    if (!cellElement) return;
    
    cellElement.classList.remove('expanded');
    cellElement.classList.add('collapsed');
    expandedCell = null;
    
    // Restore click handler and rebuild collapsed content
    const venue = cellElement.dataset.venue;
    const time = cellElement.dataset.time;
    
    if (venue && time) {
        const newContent = createCellContent(venue, time);
        cellElement.parentNode.replaceChild(newContent, cellElement);
    }
}

// QR Code Functions
function generateQRCode() {
    const registrationForm = `Registration Form
================
Name: _______________
Email: ______________
Membership Type: [ ] Official [ ] Temporary
Date: ${new Date().toLocaleDateString()}

Please submit this form to the administrator.
Contact: admin@venue.com`;
    
    const qrData = encodeURIComponent(registrationForm);
    const qrCodeURL = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${qrData}`;
    
    document.getElementById('qrCodeImage').src = qrCodeURL;
    document.getElementById('qrContainer').style.display = 'block';
}

// Utility Functions
function getUserInitials(username) {
    if (!username) return '';
    const words = username.trim().split(/\s+/);
    if (words.length === 1) {
        return words[0].substring(0, 2).toUpperCase();
    } else {
        return words.slice(0, 2).map(word => word.charAt(0).toUpperCase()).join('');
    }
}

function isVenueOpenOnDate(venue, date) {
    const venueInfo = venueStatus[venue];
    if (!venueInfo.open) return false;
    const dateStr = date.toDateString();
    return !venueInfo.closedDates.includes(dateStr);
}

function showNotification(message) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed; top: 20px; right: 20px;
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white; padding: 15px 20px; border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); z-index: 1000; font-weight: 600;
    `;
    notification.textContent = message;
    document.body.appendChild(notification);
    setTimeout(() => notification.remove(), 3000);
}

// Login Functions
function login() {
    const userId = document.getElementById('userIdInput').value.trim();
    const adminCheck = document.getElementById('adminCheck').checked;
    
    if (userId) {
        currentUser = userId;
        currentUserSkillLevel = 'beginner';
        isAdmin = adminCheck;
        userSkillLevels[userId] = currentUserSkillLevel;
        
        if (isAdmin) {
            document.getElementById('adminUserDisplay').textContent = `Administrator: ${userId}`;
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('adminApp').style.display = 'block';
            initializeAdminApp();
        } else {
            updateUserDisplay();
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('adminApp').style.display = 'none';
            initializeApp();
        }
    } else {
        alert('Please enter a valid User ID');
    }
}

function logout() {
    currentUser = '';
    currentUserSkillLevel = 'beginner';
    userBooking = null;
    isAdmin = false;
    timeOffset = 0;
    expandedCell = null;
    
    document.getElementById('userIdInput').value = '';
    document.getElementById('adminCheck').checked = false;
    
    if (timeCheckInterval) {
        clearInterval(timeCheckInterval);
        timeCheckInterval = null;
    }
    
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('mainApp').style.display = 'none';
    document.getElementById('adminApp').style.display = 'none';
    
    closeMessageBoard();
    closeAdminMessageBoard();
    closeVenueModal();
}

// Initialize Functions
function initializeBookingData() {
    venues.forEach(venue => {
        bookingData[venue] = {};
        timeSlots.forEach(time => {
            bookingData[venue][time] = [];
        });
    });
}

function addSampleBookings() {
    bookingData['Field 1']['19:00'] = ['John', 'Alice'];
    bookingData['Field 2']['19:20'] = ['Bob', 'Carol', 'Dave'];
    bookingData['Field 2']['23:00'] = ['Bob', 'Carol', 'Dave'];
    bookingData['Field 3']['20:00'] = ['Eve', 'Frank'];
    bookingData['Field 5']['23:00'] = ['Grace', 'Henry', 'Ivy', 'Jack'];
    bookingData['Field 7']['22:00'] = ['Kate', 'Liam'];
    bookingData['Field 4']['20:40'] = ['Sarah', 'Mike'];
    bookingData['Field 6']['21:40'] = ['Tom'];
    
    userSkillLevels = {
        'John': 'beginner', 'Alice': 'advanced', 'Bob': 'beginner', 'Carol': 'advanced',
        'Dave': 'beginner', 'Eve': 'advanced', 'Frank': 'beginner', 'Grace': 'advanced',
        'Henry': 'beginner', 'Ivy': 'advanced', 'Jack': 'beginner', 'Kate': 'advanced',
        'Liam': 'beginner', 'Sarah': 'advanced', 'Mike': 'beginner', 'Tom': 'advanced'
    };
}

function initializeApp() {
    initializeBookingData();
    addSampleBookings();
    populateFilters();
    generateTable();
    updateCurrentTime();
    setInterval(updateCurrentTime, 1000);
    
    if (timeCheckInterval) clearInterval(timeCheckInterval);
    timeCheckInterval = setInterval(manageCellStatesByTime, 60000);
    manageCellStatesByTime();
    
    // Add click listener to collapse expanded cells
    document.addEventListener('click', function(e) {
        if (expandedCell && !expandedCell.contains(e.target)) {
            collapseCell(expandedCell);
        }
    });
}

function initializeAdminApp() {
    initializeBookingData();
    addSampleBookings();
    loadVenueList();
    loadUserMembership();
    updateAdminCurrentTime();
    setInterval(updateAdminCurrentTime, 1000);
}

function updateCurrentTime() {
    const now = getAdjustedTime();
    const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
    const dateStr = now.toLocaleDateString(undefined, dateOptions);
    const timeStr = now.toLocaleTimeString(undefined, timeOptions);
    document.getElementById('currentTime').textContent = `${dateStr} ${timeStr}`;
}

function updateAdminCurrentTime() {
    const now = new Date();
    const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
    const dateStr = now.toLocaleDateString(undefined, dateOptions);
    const timeStr = now.toLocaleTimeString(undefined, timeOptions);
    document.getElementById('adminCurrentTime').textContent = `${dateStr} ${timeStr}`;
}

// Table Functions
function populateFilters() {
    const venueFilter = document.getElementById('venueFilter');
    const timeFilter = document.getElementById('timeFilter');
    
    venueFilter.innerHTML = '<option value="">All Fields</option>';
    timeFilter.innerHTML = '<option value="">All Times</option>';
    
    venues.forEach(venue => {
        const option = document.createElement('option');
        option.value = venue;
        option.textContent = venue;
        venueFilter.appendChild(option);
    });
    
    timeSlots.forEach(time => {
        const option = document.createElement('option');
        option.value = time;
        option.textContent = time;
        timeFilter.appendChild(option);
    });
}

function generateTable() {
    const header = document.getElementById('tableHeader');
    const body = document.getElementById('tableBody');
    
    header.innerHTML = '';
    body.innerHTML = '';
    
    const filteredVenues = getFilteredVenues();
    let filteredTimes = getFilteredTimes();

    // Create header - Time slots as columns
    const headerRow = document.createElement('tr');
    headerRow.innerHTML = '<th>Venue / Time</th>';
    filteredTimes.forEach(time => {
        headerRow.innerHTML += `<th>${time}</th>`;
    });
    header.appendChild(headerRow);
    
    // Create body rows - Venues as rows
    filteredVenues.forEach(venue => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${venue}</td>`;
        
        filteredTimes.forEach(time => {
            const cell = document.createElement('td');
            const cellContent = createCellContent(venue, time);
            cell.appendChild(cellContent);
            row.appendChild(cell);
        });
        
        body.appendChild(row);
    });
    
    setTimeout(manageCellStatesByTime, 100);
}

function createCellContent(venue, time) {
    const cellDiv = document.createElement('div');
    cellDiv.className = 'cell-content collapsed';
    cellDiv.dataset.venue = venue;
    cellDiv.dataset.time = time;
    
    const today = new Date();
    const isOpenToday = isVenueOpenOnDate(venue, today);
    
    if (!isOpenToday) {
        cellDiv.classList.add('venue-closed');
        cellDiv.innerHTML = '<div class="closed-text">CLOSED</div>';
        cellDiv.style.cursor = 'not-allowed';
        return cellDiv;
    }
    
    const capacity = venueCapacities[venue];
    const booked = bookingData[venue][time].length;
    const bookedUsers = bookingData[venue][time];
    const isUserBooked = userBooking && userBooking.venue === venue && userBooking.time === time;
    const isFull = booked >= capacity;
    
    // Capacity info
    const capacityInfo = document.createElement('div');
    capacityInfo.className = 'capacity-info';
    capacityInfo.textContent = `${booked}/${capacity}`;
    cellDiv.appendChild(capacityInfo);
    
    // User dots display for collapsed view
    if (booked > 0) {
        const dotsContainer = document.createElement('div');
        dotsContainer.className = 'user-dots-container';
        
        const maxDotsToShow = 4;
        const dotsToShow = Math.min(booked, maxDotsToShow);
        
        for (let i = 0; i < dotsToShow; i++) {
            const user = bookedUsers[i];
            const dot = document.createElement('div');
            dot.className = 'user-dot';
            
            const userSkillLevel = userSkillLevels[user] || 'beginner';
            dot.classList.add(userSkillLevel);
            
            if (user === currentUser) {
                dot.classList.add('current-user');
            }
            
            dot.title = `${user} (${userSkillLevel === 'beginner' ? 'Beginner' : 'Advanced'})`;
            dotsContainer.appendChild(dot);
        }
        
        // Show overflow count if there are more users
        if (booked > maxDotsToShow) {
            const overflowCount = document.createElement('span');
            overflowCount.className = 'user-count-overflow';
            overflowCount.textContent = `+${booked - maxDotsToShow}`;
            dotsContainer.appendChild(overflowCount);
        }
        
        cellDiv.appendChild(dotsContainer);
    }
    
    // Apply styling based on status
    if (isUserBooked) {
        cellDiv.classList.add('user-booked-cell');
    } else if (isFull) {
        cellDiv.classList.add('full-cell');
    } else if (booked > 0) {
        cellDiv.classList.add('booked-cell');
    }
    
    // Click handler
    if (booked === 0) {
        // Empty cell - direct booking
        cellDiv.onclick = () => bookSlot(venue, time);
    } else {
        // Cell with bookings - expand to view details and show booking/cancel options
        cellDiv.onclick = (e) => {
            e.stopPropagation();
            expandCell(cellDiv, venue, time);
        };
    }
    
    return cellDiv;
}

function getFilteredVenues() {
    const filter = document.getElementById('venueFilter').value;
    return filter ? [filter] : venues;
}

function getFilteredTimes() {
    const filter = document.getElementById('timeFilter').value;
    return filter ? [filter] : timeSlots;
}

function filterTable() {
    generateTable();
}

function filterUpcoming() {
    const venueFilter = document.getElementById('venueFilter');
    const timeFilter = document.getElementById('timeFilter');
    
    venueFilter.value = "";
    timeFilter.value = "";
    generateTable();
}

// Booking Functions
function bookSlot(venue, time) {
    if (!isVenueOpenOnDate(venue, new Date())) {
        alert('This venue is currently closed.');
        return;
    }
    
    const currentMinutes = getCurrentTimeInMinutes();
    const slotMinutes = parseTimeToMinutes(time);
    if (currentMinutes >= slotMinutes && isTimeManagementActive) {
        alert('Cannot book a time slot that has already passed.');
        return;
    }
    
    // Check if user has a valid (future) booking and auto-cancel it
    if (userBooking) {
        const existingSlotMinutes = parseTimeToMinutes(userBooking.time);
        const isExistingBookingValid = existingSlotMinutes > currentMinutes || !isTimeManagementActive;
        
        if (isExistingBookingValid) {
            // Auto-cancel the existing valid booking
            const { venue: oldVenue, time: oldTime } = userBooking;
            const oldBookings = bookingData[oldVenue][oldTime];
            const userIndex = oldBookings.indexOf(currentUser);
            
            if (userIndex > -1) {
                oldBookings.splice(userIndex, 1);
            }
            
            showNotification(`Previous booking at ${oldVenue} (${oldTime}) was automatically cancelled`);
        }
    }
    
    const capacity = venueCapacities[venue];
    const currentBookings = bookingData[venue][time];
    
    if (currentBookings.length < capacity) {
        currentBookings.push(currentUser);
        userBooking = { venue, time };
        generateTable();
        
        setTimeout(() => {
            showNotification(`Successfully booked ${venue} at ${time}`);
        }, 100);
    } else {
        alert('This slot is fully booked!');
    }
}

function cancelBooking() {
    if (userBooking) {
        const { venue, time } = userBooking;
        
        const currentMinutes = getCurrentTimeInMinutes();
        const slotMinutes = parseTimeToMinutes(time);
        if (currentMinutes >= slotMinutes && isTimeManagementActive) {
            alert('Cannot cancel a booking for a time slot that has already passed.');
            return;
        }
        
        const bookings = bookingData[venue][time];
        const userIndex = bookings.indexOf(currentUser);
        
        if (userIndex > -1) {
            bookings.splice(userIndex, 1);
        }
        
        userBooking = null;
        generateTable();
        
        setTimeout(() => {
            showNotification(`Booking cancelled for ${venue} at ${time}`);
        }, 100);
    }
}

// Message Board Functions
function toggleMessageBoard() {
    const overlay = document.getElementById('messageBoardOverlay');
    if (overlay.style.display === 'none' || overlay.style.display === '') {
        showMessageBoard();
    } else {
        closeMessageBoard();
    }
}

function showMessageBoard() {
    document.getElementById('messageBoardOverlay').style.display = 'block';
    loadMessages();
}

function closeMessageBoard() {
    document.getElementById('messageBoardOverlay').style.display = 'none';
}

function loadMessages() {
    const content = document.getElementById('messageBoardContent');
    
    if (messages.length === 0) {
        content.innerHTML = '<div style="text-align: center; color: #666; font-style: italic; padding: 40px;">No messages available.</div>';
        return;
    }

    const sortedMessages = [...messages].sort((a, b) => b.timestamp - a.timestamp);
    
    content.innerHTML = sortedMessages.map(message => `
        <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px; padding: 20px; margin-bottom: 15px; border-left: 5px solid #4facfe;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <span style="font-weight: 600; color: #4facfe;">${message.author}</span>
                <span style="font-size: 12px; color: #666;">${message.date}</span>
            </div>
            <div style="color: #333; line-height: 1.6;">${message.text}</div>
        </div>
    `).join('');
}

// Admin Functions
function showAdminMessageBoard() {
    document.getElementById('adminMessageBoardOverlay').style.display = 'block';
    loadAdminMessages();
}

function closeAdminMessageBoard() {
    document.getElementById('adminMessageBoardOverlay').style.display = 'none';
}

function loadAdminMessages() {
    const content = document.getElementById('adminMessageBoardContent');
    
    if (messages.length === 0) {
        content.innerHTML = '<div style="text-align: center; color: #666; font-style: italic; padding: 40px;">No messages available.</div>';
        return;
    }

    const sortedMessages = [...messages].sort((a, b) => b.timestamp - a.timestamp);
    
    content.innerHTML = sortedMessages.map(message => `
        <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 15px; padding: 20px; margin-bottom: 15px; border-left: 5px solid #4facfe;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; gap: 10px;">
                <span style="font-weight: 600; color: #4facfe;">${message.author}</span>
                <span style="font-size: 12px; color: #666;">${message.date}</span>
                <button onclick="editMessage(${message.id})" style="padding: 4px 8px; border: none; border-radius: 4px; cursor: pointer; font-size: 10px; font-weight: 600; background: #4facfe; color: white;">Edit</button>
                <button onclick="deleteMessage(${message.id})" style="padding: 4px 8px; border: none; border-radius: 4px; cursor: pointer; font-size: 10px; font-weight: 600; background: #ff6b6b; color: white;">Delete</button>
            </div>
            <div style="color: #333; line-height: 1.6;">${message.text}</div>
        </div>
    `).join('');
}

function addNewMessage() {
    const text = prompt('Enter message text:');
    if (text) {
        const newMessage = {
            id: Date.now(),
            author: currentUser,
            text: text,
            date: new Date().toLocaleDateString(),
            timestamp: new Date()
        };
        messages.push(newMessage);
        loadAdminMessages();
    }
}

function editMessage(id) {
    const message = messages.find(m => m.id === id);
    if (message) {
        const newText = prompt('Edit message:', message.text);
        if (newText !== null) {
            message.text = newText;
            loadAdminMessages();
        }
    }
}

function deleteMessage(id) {
    if (confirm('Are you sure you want to delete this message?')) {
        const index = messages.findIndex(m => m.id === id);
        if (index > -1) {
            messages.splice(index, 1);
            loadAdminMessages();
        }
    }
}

// Venue Management Functions
function showAddVenueModal() {
    document.getElementById('venueModalTitle').textContent = 'Add New Venue';
    document.getElementById('venueName').value = '';
    document.getElementById('venueCapacity').value = '4';
    document.getElementById('venueStatus').value = 'open';
    loadTimeSlots();
    document.getElementById('venueModal').style.display = 'block';
}

function editVenue(venueName) {
    document.getElementById('venueModalTitle').textContent = 'Edit Venue';
    document.getElementById('venueName').value = venueName;
    document.getElementById('venueCapacity').value = venueCapacities[venueName];
    document.getElementById('venueStatus').value = venueStatus[venueName].open ? 'open' : 'closed';
    loadTimeSlots();
    document.getElementById('venueModal').style.display = 'block';
}

function deleteVenue(venueName) {
    if (confirm(`Are you sure you want to delete ${venueName}?`)) {
        const index = venues.indexOf(venueName);
        if (index > -1) {
            venues.splice(index, 1);
            delete venueCapacities[venueName];
            delete venueStatus[venueName];
            delete bookingData[venueName];
            loadVenueList();
        }
    }
}

function loadTimeSlots() {
    const editor = document.getElementById('timeSlotsEditor');
    editor.innerHTML = '';
    
    timeSlots.forEach((slot, index) => {
        const div = document.createElement('div');
        div.className = 'time-slot-item';
        div.innerHTML = `
            <input type="time" value="${slot}" onchange="updateTimeSlot(${index}, this.value)">
            <button type="button" class="remove-time-btn" onclick="removeTimeSlot(${index})">Remove</button>
        `;
        editor.appendChild(div);
    });
}

function addTimeSlot() {
    timeSlots.push('19:00');
    loadTimeSlots();
}

function removeTimeSlot(index) {
    if (timeSlots.length > 1) {
        timeSlots.splice(index, 1);
        loadTimeSlots();
    }
}

function updateTimeSlot(index, value) {
    timeSlots[index] = value;
}

function closeVenueModal() {
    document.getElementById('venueModal').style.display = 'none';
}

function loadVenueList() {
    const container = document.getElementById('venueList');
    container.innerHTML = '';
    
    venues.forEach(venue => {
        const div = document.createElement('div');
        div.className = 'venue-item';
        
        const isOpen = venueStatus[venue].open;
        const capacity = venueCapacities[venue];
        
        div.innerHTML = `
            <div class="venue-info">
                <h4>${venue}</h4>
                <p>Capacity: ${capacity} | Status: ${isOpen ? 'Open' : 'Closed'}</p>
            </div>
            <div class="venue-actions">
                <button class="edit-btn" onclick="editVenue('${venue}')">Edit</button>
                <button class="delete-btn" onclick="deleteVenue('${venue}')">Delete</button>
            </div>
        `;
        container.appendChild(div);
    });
}

// User Membership Functions
function loadUserMembership() {
    const container = document.getElementById('userMembershipContainer');
    container.innerHTML = '';
    
    Object.entries(userMembership).forEach(([username, data]) => {
        const userDiv = document.createElement('div');
        userDiv.style.cssText = `
            display: grid; grid-template-columns: 1fr auto auto; gap: 15px; align-items: center;
            padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px; border-left: 5px solid #4facfe; margin-bottom: 15px;
        `;
        
        const now = new Date();
        const isExpired = data.expiry < now;
        const timeLeft = data.expiry - now;
        const daysLeft = Math.ceil(timeLeft / (1000 * 60 * 60 * 24));
        
        userDiv.innerHTML = `
            <div>
                <div style="font-weight: 600; color: #333; font-size: 16px; margin-bottom: 5px;">${username}</div>
                <div style="display: inline-block; padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 600; text-transform: uppercase; ${data.type === 'official' ? 'background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white;' : 'background: linear-gradient(135deg, #ffa502 0%, #ff6348 100%); color: white;'}">${data.type.charAt(0).toUpperCase() + data.type.slice(1)} Member</div>
            </div>
            <div style="text-align: center;">
                <div style="font-weight: 600; color: #333;">Expires: ${data.expiry.toLocaleDateString()}</div>
                <div style="font-size: 12px; color: ${isExpired ? '#ff6b6b' : '#666'}; padding: 2px 6px; background: ${isExpired ? 'rgba(255, 107, 107, 0.1)' : 'rgba(79, 172, 254, 0.1)'}; border-radius: 4px; margin-top: 5px;">${isExpired ? 'EXPIRED' : daysLeft > 0 ? `${daysLeft} days left` : 'Expires today'}</div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button onclick="editUserMembership('${username}')" style="padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; background: #4facfe; color: white;">Edit</button>
                <button onclick="deleteUser('${username}')" style="padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; background: #ff6b6b; color: white;">Delete</button>
            </div>
        `;
        container.appendChild(userDiv);
    });
}

function editUserMembership(username) {
    const user = userMembership[username];
    if (!user) return;
    
    const newExpiry = prompt(`Edit expiry date for ${username} (YYYY-MM-DD):`, 
                            user.expiry.toISOString().split('T')[0]);
    if (newExpiry) {
        userMembership[username].expiry = new Date(newExpiry);
        loadUserMembership();
    }
}

function deleteUser(username) {
    if (confirm(`Are you sure you want to delete ${username}?`)) {
        delete userMembership[username];
        loadUserMembership();
    }
}

function addNewUser() {
    const username = prompt('Enter username:');
    if (!username) return;
    
    const type = prompt('Enter membership type (official/temporary):');
    if (type !== 'official' && type !== 'temporary') {
        alert('Invalid membership type');
        return;
    }
    
    const expiry = prompt('Enter expiry date (YYYY-MM-DD):');
    if (!expiry) return;
    
    userMembership[username] = {
        type: type,
        expiry: new Date(expiry)
    };
    loadUserMembership();
}

// Venue Form Handler
document.getElementById('venueForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const name = document.getElementById('venueName').value.trim();
    const capacity = parseInt(document.getElementById('venueCapacity').value);
    const status = document.getElementById('venueStatus').value === 'open';
    
    if (!name) {
        alert('Please enter a venue name');
        return;
    }
    
    const isEditing = venues.includes(name);
    
    if (!isEditing) {
        venues.push(name);
    }
    
    venueCapacities[name] = capacity;
    venueStatus[name] = { open: status, closedDates: [] };
    
    if (!bookingData[name]) {
        bookingData[name] = {};
        timeSlots.forEach(time => {
            bookingData[name][time] = [];
        });
    }
    
    loadVenueList();
    closeVenueModal();
    
    if (isEditing) {
        alert(`Venue "${name}" updated successfully`);
    } else {
        alert(`Venue "${name}" added successfully`);
    }
});

// Handle escape key to close modals
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeMessageBoard();
        closeAdminMessageBoard();
        closeVenueModal();
        if (expandedCell) {
            collapseCell(expandedCell);
        }
    }
});

// Initialize when page loads
window.addEventListener('load', () => {
    userMembership['Temporary Member A'].expiry.setHours(23, 59, 59, 999);
});
    </script>
</body>
</html>
                